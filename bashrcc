if [ -z "$TMUX" ]; then
    # Check if the session exists, otherwise create it
    tmux has-session -t main-root 2>/dev/null
    if [ $? != 0 ]; then
        tmux new-session -d -s main-root -n terminal
        tmux new-window -t main-root:1 -n menu "bash -c '
            while true; do
                clear
                echo \"=== Main Menu ===\"
                echo \"1) Run SEToolkit\"
                echo \"2) Run selfcode.py\"
                echo \"3) Exit menu\"
                echo
                read -p \"Choose an option: \" choice
                case \$choice in
                    1) cd /opt && source venv/bin/activate && NO_AT_BRIDGE=1 setoolkit ;;
                    2) cd /opt && source venv/bin/activate && NO_AT_BRIDGE=1 python selfcode.py ;;
                    3) break ;;
                esac
            done
            exec bash
        '"
    fi
    exec tmux attach -t main-root
fi
